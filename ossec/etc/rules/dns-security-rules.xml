<!-- DNS Tunneling Detection -->
<group name="dns_tunneling,">
  <rule id="100100" level="10">
    <decoded_as>dns-query</decoded_as>
    <field name="domain">\.{50,}</field>
    <description>DNS tunneling suspected: Very long domain name</description>
  </rule>
  
  <rule id="100101" level="8">
    <decoded_as>dns-query</decoded_as>
    <field name="domain">[a-zA-Z0-9+/=]{20,}\.</field>
    <description>DNS tunneling suspected: Base64-like encoding in domain</description>
  </rule>
</group>

<!-- DGA Detection -->
<group name="dga_detection,">
  <rule id="100200" level="7">
    <if_sid>100100</if_sid>
    <field name="domain">[bcdfghjklmnpqrstvwxyz]{8,}\.</field>
    <description>Potential DGA domain: Excessive consonants</description>
  </rule>
</group>

<!-- DHCP + DNS Correlation -->
<group name="dhcp_dns_correlation,">
  <rule id="100300" level="5">
    <decoded_as>kea-lease</decoded_as>
    <description>New DHCP lease: $(mac) -> $(ip)</description>
  </rule>
  
  <rule id="100301" level="10">
    <if_sid>100300</if_sid>
    <same_source_ip />
    <timeframe>300</timeframe>
    <description>Suspicious DNS activity from newly leased IP $(ip)</description>
  </rule>
</group>

<group name="pihole_security,">
  <rule id="100400" level="7">
    <program_name>pihole-FTL</program_name>
    <field name="dnsmasq.log">blocked</field>
    <frequency>50</frequency>
    <timeframe>60</timeframe>
    <description>High volume of blocked domains from single client</description>
  </rule>
</group>